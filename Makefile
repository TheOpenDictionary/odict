
# ---------------------------------------------------------------------------- #
#                                    Schema                                    #
# ---------------------------------------------------------------------------- #

schema:
	flatc -g -o . schema/schema.fbs

# ---------------------------------------------------------------------------- #
#                                    Library                                   #
# ---------------------------------------------------------------------------- #

OUTPUT=build

cgo: schema
	go build -buildmode=c-shared -o ${OUTPUT} ./cgo.go

test:
	go test ./go
	
# ---------------------------------------------------------------------------- #
#                                      CLI                                     #
# ---------------------------------------------------------------------------- #

cli:
	go build -o ${OUTPUT} .

# ---------------------------------------------------------------------------- #
#                                    Python                                    #
# ---------------------------------------------------------------------------- #

python:
	poetry build

pytest: python
	RUNTIME_ENV=test cd python && poetry run pytest ./odict && cd ..

clean:
	rm -rf setup.py dist build schema/*.go